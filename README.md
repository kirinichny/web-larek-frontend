# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- `src/` — исходные файлы проекта
- `src/components/` — папка с JS компонентами
- `src/components/base/` — папка с базовым кодом

Важные файлы:

- `src/pages/index.html` — HTML-файл главной страницы
- `src/types/index.ts` — файл с типами
- `src/index.ts` — точка входа приложения
- `src/styles/styles.scss` — корневой файл стилей
- `src/utils/constants.ts` — файл с константами
- `src/utils/utils.ts` — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```Shell
npm install
npm run start
```

или

```Shell
yarn
yarn start
```

## Сборка

```Shell
npm run build
```

или

```Shell
yarn build
```

## Данные и типы данных, используемые в приложении

### Типы данных

В приложении используются несколько различных типов данных для представления информации о продуктах и заказах.
Рассмотрим основные из них.

#### PaymentMethod

Тип PaymentMethod представляет способ оплаты и может иметь одно из двух значений:

- `online` - онлайн-оплата,
- `cash` - оплата наличными.

```TypeScript
type PaymentMethod = 'online' | 'cash';
```

#### price

Тип `price` используется для хранения стоимости продукта. Он может быть числовым значением или null, если стоимость не
задана.

```TypeScript
type price = number | null;
```

### Интерфейсы

Используемые интерфейсы описывают структуру объектов, необходимых для функционирования приложения.

#### IProduct

Интерфейс `IProduct` описывает товар и включает в себя следующие свойства:

- `id (string)` - уникальный идентификатор товара,
- `category (string)` - категория, к которой относится товар,
- `title (string)` - наименование товара,
- `description (string)` - описание товара,
- `image (string)` - ссылка на изображение товара,
- `price (price)` - стоимость товара.

```TypeScript
interface IProduct {
	id: string;
	category: string;
	title: string;
	description: string;
	image: string;
	price: price;
}
```

#### IOrder

Интерфейс `IOrder` описывает заказ и включает в себя следующие свойства:

- `email (string)` - электронная почта клиента,
- `phone (string)` - телефонный номер клиента,
- `address (string)` - адрес доставки,
- `payment (PaymentMethod)` - способ оплаты,
- `items (string[])` - список идентификаторов заказанных продуктов,
- `total (number)` - общая сумма заказа.

```TypeScript
interface IOrder {
	email: string;
	phone: string;
	address: string;
	payment: PaymentMethod;
	items: string[];
	total: number;
}
```

### Валидируемые ошибки заказа

Тип `OrderValidationErrors` представляет собой частичный объект, где ключи совпадают с ключами интерфейса `IOrder`, а
значения - это строки, содержащие сообщения об ошибках валидации.

```TypeScript
type OrderValidationErrors = Partial<Record<keyof IOrder, string>>;
```

## Архитектура приложения

Код приложения организован в виде слоев, следуя парадигме MVP:

- Слой представления (View) — отвечает за отображение данных на странице,
- Слой данных (Model) — занимается хранением и изменением данных,
- Презентер (Presenter) — выполняет роль посредника между представлением и данными.

### Базовый код

#### Класс Api

##### Описание

Класс `Api` отвечает за базовую логику отправки HTTP-запросов. В конструктор класса передаются базовый URL сервера и
опциональный объект с заголовками запросов.

##### Методы

- `get` Выполняет GET запрос на указанный URL (эндпоинт) и возвращает промис с объектом, полученным в ответе от сервера.
- `post` Принимает объект с данными для передачи в теле запроса в формате JSON и отправляет их на указанный эндпоинт. По
  умолчанию выполняет POST запрос, но метод зависит от переданного третьего параметра (POST, PUT или DELETE).

#### Класс EventEmitter

Брокер событий предоставляет функционал для отправки и подписки на события в системе. Этот класс используется в
презентерах для обработки событий, а также в различных слоях приложения для генерации событий.

##### Основные методы класса описаны интерфейсом IEvents:

- `on` - подписка на событие.
- `emit` - инициирование события.
- `trigger` - возвращает функцию, при вызове которой инициируется указанное в параметрах событие.

### Слой данных

#### Класс ProductService

Класс ProductService отвечает за хранение и логику работы с данными товаров.
Конструктор класса принимает инстанс брокера событий. В полях класса хранятся данные о списке товаров и выбранном
товаре. Также класс предоставляет набор методов для взаимодействия с этими данными.

##### Свойства класса:

- `products`: массив объектов товаров.
- `selectedProduct`: объект выбранного для просмотра товара или значение null, если товар не выбран.
- `events`: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

##### Методы класса:

- `getProducts()`: Возвращает текущий список товаров.
- `setProducts(value: IProduct[])`: Устанавливает новый список товаров и вызывает событие `products:changed`.
- `setSelectedProduct(value: IProduct | null)`: Устанавливает выбранный товар для просмотра и вызывает
  событие `product:selected`.

#### Класс OrderService

Класс `OrderService` отвечает за хранение и логику работы с данными текущего заказа. Конструктор класса принимает
инстанс брокера событий. В полях класса хранятся данные, такие как email, телефон, адрес, метод оплаты, список товаров,
общая стоимость и ошибки валидации. Также класс предоставляет набор методов для взаимодействия с этими данными.

##### Свойства класса:

- `email`: строка, представляющая электронную почту клиента.
- `phone`: строка, представляющая телефон клиента.
- `address`: строка, представляющая адрес клиента.
- `payment`: объект, представляющий метод оплаты клиента.
- `items`: массив объектов, представляющий товары в заказе.
- `totalCost`: число, представляющее общую стоимость заказа.
- `validationErrors`: объект, содержащий ошибки валидации заказа.

##### Методы класса:

- `setPaymentMethod(value: string)`: Устанавливает метод оплаты.
- `setField(fieldName: keyof Omit<IOrder, 'payment' | 'items' | 'total'>, value: string)`: Устанавливает значение
  указанного поля.
- `addItem(item: IProduct)`: Добавляет товар в заказ и обновляет общую стоимость.
- `deleteItem(item: IProduct)`: Удаляет товар из заказа и обновляет общую стоимость.
- `updateTotalCost()`: Обновляет общую стоимость заказа на основе текущих товаров.
- `getEmail()`: Возвращает email клиента.
- `getPhone()`: Возвращает телефон клиента.
- `getAddress()`: Возвращает адрес клиента.
- `getPaymentMethod()`: Возвращает метод оплаты.
- `getItems()`: Возвращает список товаров.
- `getTotalCost()`: Возвращает общую стоимость заказа.
- `getFormattedTotalCost()`: Возвращает отформатированную общую стоимость заказа.
- `getItemCount()`: Возвращает количество товаров в заказе.
- `isOrderEmpty()`: Проверяет, пуст ли заказ.
- `isItemInOrder(item: IProduct)`: Проверяет, содержится ли товар в заказе.
- `validateField(field: keyof IOrder)`: Выполняет валидацию указанного поля.
- `clearOrder()`: Очищает данные заказа и сбрасывает все поля.

### Классы представления

Все классы представления отвечают за отображение передаваемых в них данных внутри контейнера (DOM-элемента).

#### Класс PageView

Класс `PageView` предназначен для управления отображением страницы приложения, включая список товаров и корзину.
Он предоставляет методы для обновления списка товаров, количества товаров в корзине и блокировки страницы.

##### Конструктор

- `constructor(container: HTMLElement, events: IEvents)`
    - Конструктор принимает контейнер, представляющий HTML-элемент страницы, и экземпляр класса EventEmitter для
      инициации событий.

##### Свойства класса

- `pageWrapperElement: HTMLElement` - основной элемент страницы.
- `productListElement: HTMLElement` - элемент, содержащий список товаров.
- `basketElement: HTMLElement` - элемент корзины.
- `basketCounterElement: HTMLElement` - элемент-счетчик товаров в корзине.
- `lockedPageClass: string` - CSS-класс, используемый для блокировки страницы.

##### Методы класса

- `setProductList(productList: HTMLElement[]): void`
    - Обновляет список товаров на странице заданным массивом элементов.

- `setBasketCounter(value: number): void`
    - Устанавливает количество товаров в корзине, отображаемое в счетчике.

- `toggleLockPage(isLocked: boolean): void`
    - Меняет состояние блокировки страницы, добавляя или удаляя соответствующий CSS-класс.

#### Класс ProductView

Класс `ProductView` отвечает за отображение товара в каталоге и предоставляет методы для установки различных свойств
товара, таких как категория, название, изображение и цена. Также позволяет добавлять обработчики событий на элемент.

##### Конструктор

- `constructor(container: HTMLElement, actions?: IProductActions)`
    - Конструктор принимает контейнер, в котором будет отображаться товар, и необязательный объект с действиями, они
      могут быть выполнены при клике на элемент товара.

##### Свойства класса:

- `categoryElement: HTMLElement` - элемент, отображающий категорию товара.
- `titleElement: HTMLElement` - элемент, отображающий название товара.
- `imageElement: HTMLImageElement` - элемент, отображающий изображение товара.
- `priceElement: HTMLElement` - элемент, отображающий цену товара.

##### Методы класса:

- `getCategoryClass(categoryName: string): string`: Возвращает класс для категории товара.
- `set category(categoryName: string)`: Устанавливает категорию товара.
- `set title(title: string)`: Устанавливает название товара.
- `set image(imageSrc: string)`: Устанавливает изображение товара.
- `set price(price: number)`: Устанавливает цену товара.
- `getFormattedPrice(): string`: Возвращает форматированную строку с ценой товара.

#### Класс ProductDetailView

Класс `ProductDetailView` расширяет `ProductView` и добавляет отображение детализированной информации о товаре, включая
описание и кнопку добавления в корзину.

##### Конструктор

- `constructor(container: HTMLElement, actions?: IProductActions)`
    - Конструктор принимает контейнер, в котором будет отображаться детализированный товар, и необязательный объект с
      действиями, они могут быть выполнены при клике на элемент товара.

##### Свойства класса:

- `descriptionElement`: HTMLElement - элемент, отображающий описание товара.
- `addToBasketButtonElement`: HTMLElement - элемент-кнопка для добавления товара в корзину.

##### Методы класса:

- `set description(value: string)`: Устанавливает описание товара.
- `setAddToBasketButtonState(isInBasket: boolean)`: Устанавливает состояние кнопки добавления в корзину (текст и
  возможность клика).

#### Класс ProductBasketView

Класс `ProductBasketView` отвечает за отображение товара в корзине и предоставляет методы для установки различных
свойств товара, таких как индекс товара, название и цена, а также кнопку для удаления из корзины.

##### Конструктор

- `constructor(container: HTMLElement, actions?: IProductActions)`
    - Конструктор принимает контейнер, в котором будет отображаться товар в корзине, и необязательный объект с
      действиями, они могут быть выполнены при клике на элемент товара.

##### Свойства класса:

- `itemIndexElement`: HTMLElement - элемент, отображающий индекс товара в корзине.
- `titleElement`: HTMLElement - элемент, отображающий название товара.
- `priceElement`: HTMLElement - элемент, отображающий цену товара.
- `deleteFromBasketButtonElement`: HTMLElement - элемент-кнопка для удаления товара из корзины.

##### Методы класса:

- `set index(value: number)`: Устанавливает индекс товара.
- `set title(title: string)`: Устанавливает название товара.
- `set price(price: number)`: Устанавливает цену товара.

#### Класс `BasketView`

Класс `BasketView` отвечает за отображение и управление корзиной покупок. Он предоставляет способы для обновления списка
товаров, общей стоимости и управления кнопкой оформления заказа.

##### Конструктор

- `constructor(container: HTMLElement, events: IEvents)`
    - Конструктор принимает контейнер элемента, где размещена корзина, и экземпляр класса `EventEmitter` для инициации
      событий.

##### Свойства класса:

- `productListElement: HTMLElement` - элемент, содержащий список товаров в корзине.
- `totalCostElement: HTMLElement` - элемент, отображающий общую стоимость.
- `checkoutButtonElement: HTMLButtonElement` - элемент кнопки для оформления заказа.

##### Методы класса:

- `set productList(productList: HTMLElement[])`: Обновляет список товаров в корзине.
- `set totalCost(totalCost: string)`: Устанавливает общую стоимость корзины.
- `toggleCheckoutButton(isDisabled: boolean)`: Включает или отключает кнопку оформления заказа.

#### Класс `Form<T>`

Класс `Form<T>` предназначен для создания форм и управления их состоянием. Он включает методы для обработки ввода данных
и отправки формы.

##### Конструктор

- `constructor(container: HTMLFormElement, events: IEvents)`
    - Конструктор принимает HTML элемент формы и экземпляр класса `EventEmitter` для инициации событий.

##### Свойства класса:

- `_submit: HTMLButtonElement` - кнопка отправки формы.
- `_errors: HTMLElement` - элемент для отображения ошибок.

##### Методы класса:

- `protected onInputChange(field: keyof T, value: string)`: Обрабатывает изменение ввода в поле формы.
- `set valid(value: boolean)`: Устанавливает состояние валидности формы.
- `set errors(value: string)`: Устанавливает текст ошибок формы.
- `render(state: Partial<T> & IFormState)`: Отображает состояние формы.

#### Класс `OrderFormView`

Класс `OrderFormView` наследует `Form` и добавляет функции для работы с формой заказа, включая выбор способа оплаты и
адреса доставки.

##### Конструктор

- `constructor(container: HTMLFormElement, events: IEvents)`
    - Конструктор принимает HTML элемент формы и экземпляр класса `EventEmitter` для инициации событий.

##### Свойства класса:

- `paymentMethodButtons: HTMLButtonElement[]` - кнопки выбора способа оплаты.
- `addressElement: HTMLInputElement` - поле ввода адреса.

##### Методы класса:

- `private handlePaymentMethodClick(evt: Event)`: Обрабатывает выбор способа оплаты.
- `set paymentMethod(value: string)`: Устанавливает выбранный способ оплаты.
- `set address(value: string)`: Устанавливает значение поля адреса.

#### Класс `ContactFormView`

Класс `ContactFormView` наследует `Form` и добавляет функции для работы с контактной информацией, включая email и
телефон.

##### Конструктор

- `constructor(container: HTMLFormElement, events: IEvents)`
    - Конструктор принимает HTML элемент формы и экземпляр класса `EventEmitter` для инициации событий.

##### Свойства класса:

- `emailElement: HTMLInputElement` - поле ввода email.
- `phoneElement: HTMLInputElement` - поле ввода телефона.

##### Методы класса:

- `set email(value: string)`: Устанавливает значение поля email.
- `set phone(value: string)`: Устанавливает значение поля телефона.

#### Класс `SuccessView`

Класс `SuccessView` отвечает за отображение сообщения об успешном выполнении действия, например, размещения заказа.

##### Конструктор

- `constructor(container: HTMLElement, actions: ISuccessActions)`
    - Конструктор принимает контейнер элемента и объект с действиями для обработки событий, таких как клик на кнопку
      закрытия.

##### Свойства класса:

- `descriptionElement: HTMLElement` - элемент для отображения описания результата.
- `closeButtonElement: HTMLElement` - элемент кнопки закрытия.

##### Методы класса:

- `set description(value: string)`: Устанавливает текст описания результата.

#### Класс ModalView

Класс ModalView реализует модальное окно и предоставляет методы open и close для управления отображением модального
окна. Устанавливает слушатели на клавиатуру для закрытия модального окна по клавише Esc, на клик в оверлей и
кнопку-крестик для закрытия окна.

##### Конструктор

- `constructor(selector: string, events: IEvents)`
    - Конструктор принимает селектор, по которому в разметке страницы будет идентифицировано модальное окно, и экземпляр
      класса `EventEmitter` для инициации событий.

##### Свойства класса:

- `selector: HTMLElement` - элемент модального окна.
- `events: IEvents` - брокер событий.

##### Методы класса:

- `open()`: Открывает модальное окно.
- `close()`: Закрывает модальное окно.
- `render(data: IModalView)`: Рендерит данные и открывает модальное окно.

### Слой коммуникации

#### Класс WebLarekApi

Расширяет класс `Api` и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

### Взаимодействие компонентов

Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль
презентера. Взаимодействие осуществляется за счет событий, генерируемых с помощью брокера событий и обработчиков этих
событий, описанных в `index.ts`. В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем
настраивается обработка событий.

#### Список всех событий, которые могут генерироваться в системе:

##### События изменения данных (генерируются классами моделями данных):

- `products:changed` - изменение данных о товарах
- `order:itemsChanged` - изменение массива товаров в заказе
- `order:validationErrorsChanged` - изменение состояния ошибок валидации заказа

##### События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление):

- `product:selected` - выбор товара
- `basket:click` - клик по корзине
- `order:itemAdd` - добавление товара в заказ
- `order:itemDelete` - удаление товара из заказа
- `order:open` - открытие формы заказа
- `order:paymentMethodChange` - изменение метода оплаты в форме заказа
- `order:submit` - отправка заказа
- `contacts:submit` - отправка контактной формы
- `modal:open` - открытие модального окна
- `modal:close` - закрытие модального окна
- `/^(order|contacts)\.\w*:change/` - изменение данных в формах заказа или контактов